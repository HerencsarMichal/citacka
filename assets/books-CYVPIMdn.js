import{s as a,u as n}from"./index-B9CXmcMK.js";const c=a("books",{state:()=>({allBooks:[],cart:[],purchasedBooks:[],isLoading:!1}),getters:{cartItemsCount(t){return t.cart.reduce((s,o)=>s+o.quantity,0)},cartTotal(t){return t.cart.reduce((s,o)=>{const e=t.allBooks.find(r=>r.id===o.bookId);return s+(e?e.price*o.quantity:0)},0)},availableBooks(t){return t.allBooks.filter(s=>s.stock>0)},libraryBooks(t){return t.purchasedBooks.map(s=>({...t.allBooks.find(e=>e.id===s.bookId),...s}))},isInCart:t=>s=>t.cart.some(o=>o.bookId===s),isPurchased:t=>s=>t.purchasedBooks.some(o=>o.bookId===s)},actions:{async initializeBooks(){this.isLoading=!0;try{const s=(await n(()=>import("./books-DP0zcj16.js"),[])).default;if(s&&Array.isArray(s))this.allBooks=s,console.log(`✅ Načítaných ${s.length} kníh`);else throw new Error("Invalid books data format")}catch(t){console.error("❌ Chyba pri načítaní kníh:",t),this.allBooks=[]}finally{this.isLoading=!1}},addToCart(t,s=1){const o=this.allBooks.find(r=>r.id===t);if(!o)return{success:!1,message:"Kniha nebola nájdená"};if(o.stock<s)return{success:!1,message:"Nedostatok kusov na sklade"};const e=this.cart.find(r=>r.bookId===t);if(e){if(o.stock<e.quantity+s)return{success:!1,message:"Nedostatok kusov na sklade"};e.quantity+=s}else this.cart.push({bookId:t,quantity:s,addedAt:new Date().toISOString()});return{success:!0,message:"Pridané do košíka"}},removeFromCart(t){const s=this.cart.findIndex(o=>o.bookId===t);s!==-1&&this.cart.splice(s,1)},updateCartQuantity(t,s){const o=this.cart.find(r=>r.bookId===t),e=this.allBooks.find(r=>r.id===t);return!o||!e?{success:!1}:s<=0?(this.removeFromCart(t),{success:!0}):s>e.stock?{success:!1,message:"Nedostatok kusov na sklade"}:(o.quantity=s,{success:!0})},clearCart(){this.cart=[]},async checkout(){if(this.cart.length===0)return{success:!1,message:"Košík je prázdny"};for(const s of this.cart){const o=this.allBooks.find(e=>e.id===s.bookId);if(!o||o.stock<s.quantity)return{success:!1,message:`Nedostatok kusov: ${o?.title||"neznáma kniha"}`}}for(const s of this.cart){const o=this.allBooks.find(e=>e.id===s.bookId);o.stock-=s.quantity;for(let e=0;e<s.quantity;e++)this.purchasedBooks.push({bookId:s.bookId,purchasedAt:new Date().toISOString(),status:"planned",progress:0})}const t={items:[...this.cart],total:this.cartTotal,date:new Date().toISOString()};return this.clearCart(),{success:!0,message:"Objednávka úspešne dokončená",order:t}},updateReadingProgress(t,s){const o=this.purchasedBooks.find(e=>e.bookId===t);o&&(o.progress=s,s===100?o.status="completed":s>0&&(o.status="reading"))},async loadBookContent(t){try{const s=this.allBooks.find(o=>o.id===t);return s?{...s,content:s.content||null}:null}catch(s){return console.error("Chyba pri načítaní knihy:",s),null}}}});export{c as u};
